<form [formGroup]="myForm" (ngSubmit)="onSubmit()">
  <h2>Create/Update Deal Overrides for month {{monthDate()}}</h2>

  @if(formReady()) {
    <fieldset>
      <table formArrayName="days">
        <thead>
        <th>Date</th>
          @for (heading of dealOverridesMonthSnapshot?.headings; track heading) {
            <th>{{heading}}</th>
          }
        </thead>
        <tbody >
          @for (g of myForm.controls.days.controls; track $index; let idx = $index) {
            <tr [formGroup]="g">
              <td>
                <input type="text" id="{{idx}}date" name="{{idx}}date" [formControl]="myForm.controls.days.at(idx).controls.overrideDay"/>
              </td>
              @for (h of g.controls.overrideValues.controls; track $index; let hdx = $index) {
                <td>
                  <input type="number" id="{{idx}}-{{hdx}}cost" name="{{idx}}-{{hdx}}cost" [formControl]="myForm.controls.days.at(idx).controls.overrideValues.at(hdx)"/>
                </td>
              }
            </tr>
          }
        </tbody>

      </table>
    </fieldset>
  }

  @if (hasErrors) {
    <h3>errors on form: </h3>
    @for ( msg of formErrors; track msg) {
      <p>{{msg}}</p>
    }

  }



  @if (transactionResult) {
    @if (transactionResult.errorCode === '0') {
      Transaction Successful!
      <p class="form-actions">
        <button type="reset" (click) = "onReset()" class="button button-flat">Close</button>
      </p>
    } @else {
      Transaction failed {{transactionResult.errorCode}} {{transactionResult.errorMessage}}
    }
  } @else {
    <p class="form-actions">
      <button type="reset" (click) = "onReset()" class="button button-flat">Cancel</button>
      <button type="submit" class="button">Save</button>
    </p>

  }

</form>


